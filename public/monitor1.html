<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitor 1</title>

    <link rel="stylesheet" type="text/css" href="style_controller.css" />
    <script src="/libraries/p5.min.js"></script>
    <script src="/libraries/p5.sound.min.js"></script>
  </head>

  <body>
    <!-- STARTSCREEN -->
    <div id="startscreen" class="startscreen">
      <div class="startscreen-content">
        <h1>
          What words describe signs of peace<br />in everyday life for you?
        </h1>

        <!-- Panel mit Eingabefeld -->
        <div id="panel" class="panel"></div>

        <p>
          Type a word to discover how people in Mostar describe <br />
          signs of peace in their everyday lives.
        </p>

        <div class="button-group">
          <button id="startBtn">start</button>
          <button id="aboutBtn">about</button>
        </div>
      </div>
    </div>

    <!-- ✅ ABOUT SCREEN -->
    <div id="aboutscreen" class="startscreen hidden">
      <div class="startscreen-content">
        <h1>About this Project</h1>
        <p>
          Mostar is often described as a divided city, a legacy of the Yugoslav
          wars of the 1990s that split the city along ethnic lines. Thirty years
          later, however, many residents no longer see themselves through this
          lens of division. To understand how people in Mostar experience peace
          today, the non-profit organization Everyday Peace Indicators (EPI)
          asked local residents a simple but profound question: What does peace
          look like in your everyday life?
          <br /><br />
          Through focus groups with women, men, and youth across seven
          neighborhoods of Mostar, EPI collected over 1'100 community-generated
          indicators of peace. These indicators reveal what people value most in
          when it comes to peace in their everyday lives — from safety, good
          governance, and clean public spaces to friendship, sport, and mutual
          respect across communities.
          <br /><br />
          In this installation, you can explore all the collected indicators,
          search by keywords, and discover semantically related expressions of
          peace. The interface allows you to navigate through the indicators by
          using the words of Mostar’s residents and reflect on how peace is
          lived and imagined.
          <br /><br />
          This work highlights that peace has many meanings—it can differ from
          country to country, region to region, neighborhood to neighborhood,
          and even person to person. There is no single correct definition. By
          engaging with these indicators, visitors are invited to appreciate the
          diversity and everyday reality of peace as it is understood by the
          people of Mostar.
        </p>

        <p>
          <em
            >ACT 1 <br />
            15.09. – 31.10.2025, HS25 <br />
            Students: Dario Foti, Stagna Schär, Petra Weber <br />
            Lecturers: Michael Flückiger (DD+A), Hanna Züllig (DI), Alain
            Leclerc von Bonin (DD+A) <br />
            Module Director: Alain Leclerc von Bonin (DD+A) <br />
            In collaboration with Interactive Things <br /><br />
            BA Data Design + Art, Hochschule Luzern & BA Digital Ideation–
            Design Film Kunst © HSLU, 2025</em
          >.
        </p>
      </div>
      <button id="backBtn" class="back-button">back to start</button>
    </div>

    <!--  MAIN APP -->
    <div id="mainApp" style="display: none">
      <div id="topbar">
        <div id="panelMain"></div>

        <div id="hamburger">&#9776;</div>
        <div id="filterMenu" class="hidden">
          <label><input type="checkbox" value="youth" checked /> Youth</label>
          <label><input type="checkbox" value="men" checked /> Men</label>
          <label><input type="checkbox" value="women" checked /> Women</label>
        </div>
      </div>

      <div id="canvasContainer"></div>
      <div id="detailsContainer">
        <div id="detailsContent"></div>
      </div>
      <div id="contentContainer">
        Content
        <h2 class="related-title">Related Voices</h2>
      </div>

      <button id="restartBtn">restart</button>
    </div>

    <!-- ✅ SOCKET.IO -->
    <script src="/socket.io/socket.io.js"></script>
    <script>
      window.socket = io();
      window.socket.emit("join", "monitor1");
    </script>

    <script>
      // Restart button → reloads entire app (go back to start)
      document.addEventListener("DOMContentLoaded", () => {
        const restartBtn = document.getElementById("restartBtn");
        if (restartBtn) {
          restartBtn.addEventListener("click", () => {
            window.location.reload(); // full reset back to start screen
          });
        }
      });
    </script>

    <script src="/Petra/sketch_controller.js"></script>

    <!-- ✅ LOGIC -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const startScreen = document.getElementById("startscreen");
        const aboutScreen = document.getElementById("aboutscreen");
        const mainApp = document.getElementById("mainApp");
        const startBtn = document.getElementById("startBtn");
        const aboutBtn = document.getElementById("aboutBtn");
        const backBtn = document.getElementById("backBtn");
        const panelMain = document.getElementById("panelMain");
        const panel = document.getElementById("panel");

        function showMainApp() {
          startScreen.classList.add("hidden");

          setTimeout(() => {
            startScreen.style.display = "none";
            mainApp.style.display = "block";

            // Move panel to main app
            panelMain.appendChild(panel);

            const input = panel.querySelector("input");
            const query = input?.value?.trim();
            if (query && window.socket) {
              window.socket.emit("control", {
                targetRoom: "visual",
                payload: { action: "searchQuery", query },
              });
            }

            window.initialSearch = query || "";
            console.log("showMainApp() executed, query:", query);
          }, 600);
        }

        startBtn.addEventListener("click", showMainApp);

        aboutBtn.addEventListener("click", () => {
          startScreen.classList.add("hidden");
          setTimeout(() => {
            startScreen.style.display = "none";
            aboutScreen.classList.remove("hidden");
            aboutScreen.style.display = "flex";
          }, 600);
        });

        backBtn.addEventListener("click", () => {
          aboutScreen.classList.add("hidden");
          setTimeout(() => {
            aboutScreen.style.display = "none";
            startScreen.classList.remove("hidden");
            startScreen.style.display = "flex";
          }, 600);
        });

        // ---------- Robust ENTER handling ----------
        // 1) Global keydown: if Enter pressed and focus is inside #panel -> showMainApp
        document.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            const active = document.activeElement;
            if (
              active &&
              (active.tagName === "INPUT" || active.tagName === "TEXTAREA")
            ) {
              if (active.closest && active.closest("#panel")) {
                event.preventDefault();
                showMainApp();
              }
            }
          }
        });

        // 2) If p5 creates the input later, ensure it has a keydown handler as well.
        //    Try to observe mutations inside #panel and attach handler once input appears.
        const attachKeyHandlerToPanelInput = () => {
          const input = panel.querySelector("input");
          if (input && !input._enterHandlerAttached) {
            input.addEventListener("keydown", (e) => {
              if (e.key === "Enter") {
                e.preventDefault();
                showMainApp();
              }
            });
            input._enterHandlerAttached = true;
            console.log("Attached keydown directly to panel input");
            return true;
          }
          return false;
        };

        // Try immediate attach (if input already exists)
        attachKeyHandlerToPanelInput();

        // MutationObserver: watch panel for added nodes (fast and clean)
        const mo = new MutationObserver((mutations) => {
          for (const m of mutations) {
            if (m.addedNodes && m.addedNodes.length) {
              if (attachKeyHandlerToPanelInput()) {
                // stop observing once we attached
                mo.disconnect();
                return;
              }
            }
          }
        });

        mo.observe(panel, { childList: true, subtree: true });

        // Fallback polling (if MutationObserver somehow doesn't detect)
        const pollInterval = setInterval(() => {
          if (attachKeyHandlerToPanelInput()) {
            clearInterval(pollInterval);
          }
        }, 300);

        // End of DOMContentLoaded
      });
    </script>
    <!-- ✅ MAIN SKETCH -->
    <script src="/Petra/sketch_controller.js"></script>
  </body>
</html>
